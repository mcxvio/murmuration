<ul data-role="listview" class="ui-listview">
    {% set prevDateTime = "" %}
    {% set prevLocation = "" %}
    {% set speciesCount = 0 %}

    {% for item in data %}
        {% if prevDateTime == "" %}
            {% set prevDateTime = item.obsDt|getdatetime('d') %}
        {% endif %}
        {% set currentDateTime = item.obsDt|getdatetime('d') %}


        {% if prevDateTime != currentDateTime %}
            <li data-role="list-divider" role="heading" class="ui-li-divider ui-body-inherit">{{ prevDateTime }}</li>
            {% set prevDateTime = currentDateTime %}
            {% set speciesCount = 1 %}
        {% endif %}

        {% if prevLocation == "" %}
            {% set prevLocation = item.locName %}
        {% endif %}

        {% set currentLocation = item.locName %}
        {% set speciesCount = (speciesCount + 1) %}

        {% if prevLocation != currentLocation %}
            <li class="ui-li-static ui-body-inherit">
                {{ speciesCount }} species
                @
                <a href="/#location" class="gotoLocation" title="{{ item.locID }}" target="_self">{{ prevLocation }}</a>
                @
        		{{ item.obsDt|getdatetime('t') }}
            </li>
            {% set prevLocation = currentLocation %}
            {% set speciesCount = 1 %}
    	{% endif %}

    {% endfor %}
</ul>